<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Espace Patient</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-light">

<!-- Navbar Patient -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark px-3 mb-4 shadow-sm">
    <a class="navbar-brand fw-bold" href="#">
        <i class="fas fa-heartbeat me-2 text-danger"></i>Espace Patient
    </a>
    <div class="ms-auto d-flex align-items-center">
            <span class="text-white me-3 small d-none d-md-inline">
                Bonjour,
                <span class="fw-bold text-warning" th:text="${patientInfo.nom}">Client</span>
            </span>
        <form th:action="@{/logout}" method="post">
            <button class="btn btn-danger btn-sm fw-bold shadow-sm" type="submit">
                <i class="fas fa-sign-out-alt me-1"></i>
            </button>
        </form>
    </div>
</nav>

<div class="container">

    <!-- Header avec Action -->
    <div class="row align-items-center mb-4">
        <div class="col">
            <h4 class="text-secondary fw-bold mb-0">
                <i class="fas fa-folder-open me-2"></i>Mon Dossier
            </h4>
        </div>
        <div class="col-auto">
            <a th:href="@{/formRDV}" class="btn btn-primary shadow-sm fw-bold rounded-pill px-4">
                <i class="fas fa-plus-circle me-2"></i>Nouveau Rendez-Vous
            </a>
        </div>
    </div>

    <!-- Carte Tableau -->
    <div class="card border-0 shadow rounded-3 overflow-hidden">
        <div class="card-body p-0">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light border-bottom">
                <tr>
                    <th class="ps-4 text-uppercase small text-muted fw-bold">Date & Heure</th>
                    <th class="text-uppercase small text-muted fw-bold">Praticien</th>
                    <th class="text-uppercase small text-muted fw-bold">Spécialité</th>
                    <th class="text-uppercase small text-muted fw-bold text-center">État de la demande</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="r : ${myRDVs}">

                    <!-- Date -->
                    <td class="ps-4">
                        <div class="d-flex align-items-center">
                            <i class="far fa-calendar text-secondary me-2"></i>
                            <span class="fw-bold text-dark" th:text="${#dates.format(r.date, 'dd MMM yyyy')}"></span>
                            <span class="badge bg-light text-dark border ms-2" th:text="${#dates.format(r.date, 'HH:mm')}"></span>
                        </div>
                    </td>

                    <!-- Médecin -->
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="avatar rounded-circle bg-info-subtle text-info-emphasis d-flex justify-content-center align-items-center me-2" style="width: 32px; height: 32px;">
                                <i class="fas fa-user-md small"></i>
                            </div>
                            <span class="fw-medium" th:text="${r.medecin.nom}"></span>
                        </div>
                    </td>

                    <!-- Spécialité -->
                    <td>
                                <span class="badge bg-secondary bg-opacity-10 text-secondary border border-secondary border-opacity-25">
                                    <span th:text="${r.medecin.specialite}"></span>
                                </span>
                    </td>

                    <!-- Statut Visuel -->
                    <td class="text-center">
                        <!-- En attente -->
                        <div th:if="${r.status.name() == 'PENDING'}">
                                    <span class="badge rounded-pill bg-warning text-dark border border-warning shadow-sm">
                                        <i class="fas fa-spinner fa-spin me-1"></i> Traitement en cours
                                    </span>
                        </div>

                        <!-- Si le statut est DONE, on affiche le bouton -->
                        <div th:if="${r.status.name() == 'DONE' && r.consultation != null}" class="mt-2">
                            <a th:href="@{/consultation/view(rdvId=${r.id})}"
                               class="btn btn-sm btn-primary rounded-pill px-3">
                                <i class="fas fa-file-pdf"></i> Rapport
                            </a>
                        </div>

                        <!-- Annulé -->
                        <div th:if="${r.status.name() == 'CANCELED'}">
                                    <span class="badge rounded-pill bg-danger border border-danger shadow-sm">
                                        <i class="fas fa-ban me-1"></i> Refusé / Annulé
                                    </span>
                        </div>
                    </td>
                </tr>

                <!-- Vide -->
                <tr th:if="${#lists.isEmpty(myRDVs)}">
                    <td colspan="4" class="text-center py-5">
                        <div class="mb-3">
                            <i class="fas fa-notes-medical fa-4x text-light"></i>
                        </div>
                        <h5 class="text-muted">Aucun historique</h5>
                        <p class="text-muted small mb-3">Prenez rendez-vous dès maintenant avec nos spécialistes.</p>
                        <a th:href="@{/formRDV}" class="btn btn-outline-primary btn-sm rounded-pill px-3">
                            Commencer
                        </a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Footer info -->
    <div class="text-center mt-4 text-muted small">
        <i class="fas fa-shield-alt me-1"></i> Vos données médicales sont confidentielles et sécurisées.
    </div>
</div>

</body>
</html>